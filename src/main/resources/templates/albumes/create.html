<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Agenda de proyectos">
    <title th:text="#{projects-agenda}">Projects Agenda</title>

    <!-- Traducciones -->
    <script>
        const translations = {
            // FullCalendar specific translations
            'currentLocale': '[[${#locale.language}]]', // Get the current locale from Thymeleaf
            'weekTableButton': '[[#{calendar.button.weekTable}]]',
            'todayButton': '[[#{calendar.button.today}]]',
            'monthButton': '[[#{calendar.button.month}]]',
            'dayButton': '[[#{calendar.button.day}]]',

            // Other translations used in the script
            'errorLoadingEvents': '[[#{calendar.error.loadingEvents}]]',
            'newProjectFor': '[[#{calendar.newProjectFor}]]',
            'projectsHeader': '[[#{calendar.table.projectsHeader}]]',
            'allDayEvent': '[[#{calendar.event.allDay}]]',
            'hideCalendarButton': '[[#{calendar.button.hideCalendar}]]', // Text for the toggle button
            'showCalendarButton': '[[#{calendar.button.showCalendar}]]',  // Text for the toggle button (if you show it again)

            // New translations for showAlbumDetailsById
            'errorFetchingDetails': '[[#{album.error.fetchDetails}]]',
            'statusCompleted': '[[#{album.status.completed}]]',
            'statusCancelled': '[[#{album.status.cancelled}]]',
            'statusPending': '[[#{album.status.pending}]]',
            'hoursSuffix': '[[#{album.details.hoursSuffix}]]',
            'markInProgress': '[[#{album.action.markInProgress}]]',
            'markCompleted': '[[#{album.action.markCompleted}]]',
            'markCancelled': '[[#{album.action.markCancelled}]]',
            'errorGeneric': '[[#{error.generic}]]',
            'errorLoadingProjectDetails': '[[#{album.error.loadDetailsAlert}]]',
            'edit': '[[#{edit}]]',
            'delete': '[[#{delete}]]',
            'success': '[[#{success}]]',
            'close': '[[#{close}]]',

            // Keys for loadProjectTeams (mapped to existing properties)
            'loading_teams': '[[#{loading-teams}]]',
            'error_loading_teams': '[[#{error-loading-teams}]]',
            'no_description': '[[#{no-description}]]',
            'team_members': '[[#{team-members}]]', // New, as it's "Team Members (X)"
            'no_teams_found': '[[#{no-teams-found}]]',
            'no_teams_assigned': '[[#{no-teams-assigned}]]'
        };
    </script>

    <!-- Bootstrap core CSS -->
    <link th:href="@{/vendor/bootstrap/css/bootstrap.min.css}" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Preload -->
    <link rel="preload"
          as="image"
          href="/img/admrescale.webp?width=1200"
          imagesrcset="/img/admrescale.webp?width=600 600w, /img/admrescale.webp?width=1200 1200w, /img/admrescale.webp?width=1800 1800w"
          imagesizes="100vw">
    <!-- Custom styles -->
    <style>
        :root {
            --primary-blue: #2c5aa0;
            --accent-blue: #3a7bd5;
            --dark-bg: #0f1923;
            --darker-bg: #0a121a;
            --light-text: #e0e0e0;
            --lighter-text: #ffffff;
            --border-color: rgba(44, 90, 160, 0.3);
            --success-color: #4cc9f0;
            --danger-color: #ff4d4d;
            --completed-color: #38b000;
        }

        /* Estructura principal */
        .bg-fast-load {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
        }

        .bg-fast-load img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.5;
        }

        body {
            font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--light-text);
            background-color: rgba(0, 0, 0, 0.94);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
        }

        .main-content-container {
            padding: 2rem 0 4rem;
        }

        /* Cabecera */
        .agenda-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .agenda-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--lighter-text);
            margin-bottom: 1rem;
            position: relative;
        }

        .agenda-title:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
            border-radius: 3px;
        }

        .agenda-description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto 1.5rem;
        }

        /* Button Styles */
        .btn-rounded {
            border-radius: 50px !important;
            padding: 0.6rem 1.2rem !important;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            z-index: 1;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
        }

        .btn-rounded::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-blue));
            z-index: -1;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .btn-primary {
            background: rgba(15, 25, 35, 0.7);
            border-color: var(--primary-blue);
            color: var(--light-text);
        }

        .btn-primary:hover::before {
            opacity: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(74, 144, 226, 0.3);
            color: var(--lighter-text);
            border-color: transparent;
        }

        .btn-secondary {
            background: rgba(15, 25, 35, 0.7);
            border-color: #6c757d;
            color: var(--light-text);
        }

        .btn-secondary:hover {
            background: rgba(108, 117, 125, 0.2);
            color: var(--lighter-text);
            border-color: #5a6268;
        }

        .btn-success {
            background: rgba(15, 25, 35, 0.7);
            border-color: var(--completed-color);
            color: var(--completed-color);
        }

        .btn-success:hover {
            background: rgba(56, 176, 0, 0.2);
            color: #a2ff7c;
            border-color: #a2ff7c;
        }

        /* Main Content Layout */
        .main-content-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .calendar-section {
            flex: 0 0 auto;
            width: 100%;
            min-width: 300px;
            display: none; /* Hidden by default */
        }

        .calendar-section.visible {
            display: block;
        }

        .list-section {
            flex: 1 1 100%;
            min-width: 300px;
        }

        /* Calendar Container */
        .calendar-container {
            background: rgba(15, 25, 35, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            height: 100%;
            backdrop-filter: blur(5px);
        }

        /* List View Container */
        .list-container {
            background: rgba(15, 25, 35, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            height: 100%;
            backdrop-filter: blur(5px);
        }

        /* List View Header */
        .list-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .list-view-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 0;
            color: var(--lighter-text);
        }

        .list-filter-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-label {
            font-size: 0.9rem;
            color: var(--light-text);
            margin-bottom: 0;
            opacity: 0.8;
        }

        .filter-select {
            border-radius: 50px;
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
            background-color: rgba(15, 25, 35, 0.7);
            color: var(--light-text);
            cursor: pointer;
        }

        .filter-select:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 0.2rem rgba(72, 149, 239, 0.25);
        }

        /* Search Box */
        .search-box {
            width: 100%;
            margin-bottom: 1rem;
        }

        .search-box .input-group-text {
            background-color: rgba(15, 25, 35, 0.7);
            border: 1px solid var(--border-color);
            border-right: none;
            color: var(--light-text);
        }

        .search-box .form-control {
            background-color: rgba(15, 25, 35, 0.7);
            border: 1px solid var(--border-color);
            border-left: none;
            color: var(--light-text);
        }

        .search-box .form-control::placeholder {
            color: var(--light-text);
            opacity: 0.6;
        }

        /* Project Card Styles */
        .project-card {
            background: rgba(15, 25, 35, 0.7);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 4px solid var(--primary-blue);
            cursor: pointer;
        }

        .project-card.completed {
            border-left-color: var(--completed-color);
            opacity: 0.9;
        }

        .project-card.completed .project-card-header {
            background-color: rgba(56, 176, 0, 0.1);
        }

        .project-card.completed .project-card-title {
            text-decoration: line-through;
            color: var(--light-text);
            opacity: 0.7;
        }

        .project-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.2);
            border-color: var(--primary-blue);
        }

        .project-card-header {
            padding: 1rem 1.2rem;
            background-color: rgba(44, 90, 160, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .project-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
            color: var(--lighter-text);
            transition: all 0.3s ease;
        }

        .project-card-date {
            font-size: 0.85rem;
            color: var(--light-text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.3rem;
            opacity: 0.8;
        }

        .project-card-body {
            padding: 1rem 1.2rem;
            display: none;
            border-top: 1px solid var(--border-color);
        }

        .project-card.active .project-card-body {
            display: block;
        }

        .project-card-description {
            font-size: 0.9rem;
            color: var(--light-text);
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .project-card-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-color);
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .status-active {
            background-color: rgba(44, 90, 160, 0.2);
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }

        .status-completed {
            background-color: rgba(56, 176, 0, 0.2);
            color: var(--completed-color);
            border: 1px solid var(--completed-color);
        }

        /* Completed Projects Section */
        .completed-projects-section {
            margin-top: 2.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--light-text);
            opacity: 0.7;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-blue);
            opacity: 0.5;
        }

        /* Modal Styles */
        .modal-content {
            border-radius: 10px;
            border: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            background-color: var(--darker-bg);
            color: var(--light-text);
        }

        .modal-header {
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
            color: var(--lighter-text);
            border-radius: 10px 10px 0 0;
            border: none;
            padding: 1.2rem;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .modal-title i {
            margin-right: 8px;
            font-size: 1.1rem;
        }

        .modal-body {
            padding: 1.5rem;
            background-color: var(--dark-bg);
        }

        .modal-footer {
            border-top: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            background-color: var(--darker-bg);
        }

        /* Form Styles */
        .form-label {
            font-weight: 500;
            color: var(--lighter-text);
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            background-color: rgba(15, 25, 35, 0.7);
            border: 1px solid var(--border-color);
            color: var(--light-text);
            border-radius: 8px;
            padding: 0.6rem 0.75rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            background-color: rgba(15, 25, 35, 0.9);
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 0.25rem rgba(72, 149, 239, 0.25);
            color: var(--lighter-text);
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10;
            max-width: 350px;
            width: 100%;
        }

        .toast {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            font-size: 0.9rem;
            width: 100%;
            background-color: var(--darker-bg);
            border: 1px solid var(--border-color);
        }

        .toast-success {
            background-color: rgba(15, 25, 35, 0.9);
            border-color: var(--success-color);
        }

        /* Detail Modal Styles */
        .detail-section {
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section h5 {
            color: var(--accent-blue);
            font-size: 1.1rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .detail-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 0.8rem;
        }

        .detail-label {
            font-weight: 600;
            color: var(--lighter-text);
            width: 150px;
            flex-shrink: 0;
        }

        .detail-value {
            flex: 1;
            color: var(--light-text);
            word-break: break-word;
            opacity: 0.9;
        }

        /* Success Notification */
        .success-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            z-index: 15;
            display: none;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--light-text);
            border: 1px solid var(--success-color);
        }

        /* Project List Grid */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        /* Project Actions */
        .project-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-btn {
            opacity: 0.7;
            transition: all 0.2s ease;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border: none;
            background: transparent;
            color: var(--light-text);
        }

        .action-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .btn-edit {
            color: var(--primary-blue);
        }

        .btn-delete {
            color: var(--danger-color);
        }

        .btn-complete {
            color: var(--completed-color);
            display: block !important;
        }

        .btn-uncomplete {
            color: var(--danger-color);
            display: block !important;
        }

        /* Event status styles */
        .completed-event {
            background-color: #6c757d !important;
            border-color: #6c757d !important;
        }

        .cancelled-event {
            background-color: var(--danger-color) !important;
            border-color: var(--danger-color) !important;
        }

        .in-progress-event {
            background-color: var(--primary-blue) !important;
            border-color: var(--primary-blue) !important;
        }

        /* Project card status styles */
        .project-card.pendiente {
            border-left: 4px solid var(--primary-blue);
            background-color: rgba(44, 90, 160, 0.1);
        }

        .project-card.completado {
            border-left: 4px solid #6c757d;
            background-color: rgba(108, 117, 125, 0.1);
        }

        .project-card.anulado {
            border-left: 4px solid var(--danger-color);
            background-color: rgba(255, 77, 77, 0.1);
        }

        /* Status badges */
        .status-pending {
            background-color: rgba(44, 90, 160, 0.2);
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }

        .status-completed {
            background-color: rgba(108, 117, 125, 0.2);
            color: #6c757d;
            border: 1px solid #6c757d;
        }

        .status-cancelled {
            background-color: rgba(255, 77, 77, 0.2);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        /* Section titles */
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--lighter-text);
            border-bottom: 2px solid var(--primary-blue);
            padding-bottom: 0.5rem;
            margin-top: 1.5rem;
        }

        #archivedProjects {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            z-index: 10;
            background-color: var(--darker-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            padding: 8px 0;
            min-width: 200px;
            display: none;
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
            color: var(--light-text);
        }

        .context-menu-item:hover {
            background-color: rgba(74, 144, 226, 0.2);
        }

        .context-menu-item i {
            margin-right: 8px;
            width: 20px;
            text-align: center;
        }

        .context-menu-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 4px 0;
        }

        /* Team management styles */
        #createTeamModal .modal-content {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        #createTeamModal .modal-header {
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
            color: var(--lighter-text);
            border-bottom: 1px solid var(--border-color);
        }

        #current-project-name {
            color: var(--lighter-text);
            font-weight: 600;
        }

        /* Tabs */
        #teamManagementTabs {
            padding: 0 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--darker-bg);
        }

        #teamManagementTabs .nav-link {
            color: var(--light-text);
            font-weight: 500;
            border: none;
            background-color: transparent;
            padding: 0.75rem 1.25rem;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        #teamManagementTabs .nav-link.active {
            color: var(--accent-blue);
            background-color: transparent;
            border-bottom: 3px solid var(--accent-blue);
            opacity: 1;
        }

        #teamManagementTabs .nav-link:hover:not(.active) {
            color: var(--lighter-text);
            background-color: rgba(74, 144, 226, 0.1);
        }

        /* Team form */
        .team-form label {
            font-weight: 500;
            color: var(--lighter-text);
            margin-bottom: 0.5rem;
        }

        .selection-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
            background-color: var(--dark-bg);
        }

        .selection-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            background-color: rgba(15, 25, 35, 0.7);
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.15s ease;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .selection-item:hover {
            background-color: rgba(74, 144, 226, 0.2);
        }

        .selection-item.selected {
            background-color: rgba(74, 144, 226, 0.3);
            border-color: var(--primary-blue);
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Team cards */
        .team-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            background-color: rgba(15, 25, 35, 0.7);
        }

        .team-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.2);
        }

        .team-card-header {
            padding: 1rem;
            background-color: var(--darker-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-card-header h5 {
            margin: 0;
            color: var(--lighter-text);
            font-weight: 600;
        }

        .team-times .badge {
            font-weight: 500;
            padding: 0.35rem 0.6rem;
            background-color: rgba(15, 25, 35, 0.7);
            border: 1px solid var(--border-color);
        }

        .team-card-body {
            padding: 1rem;
        }

        .team-description {
            color: var(--light-text);
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .team-members h6 {
            font-size: 0.9rem;
            color: var(--lighter-text);
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        .members-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .member-item {
            display: flex;
            align-items: center;
            background-color: rgba(15, 25, 35, 0.7);
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
        }

        .member-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: var(--primary-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 0.75rem;
            margin-right: 0.5rem;
        }

        .member-name {
            font-weight: 500;
            color: var(--lighter-text);
        }

        .member-name.duplicate-member {
            color: var(--danger-color);
            font-weight: 600;
        }

        .member-role {
            font-size: 0.75rem;
            color: var(--light-text);
        }

        /* Responsive adjustments */
        @media (max-width: 991px) {
            .main-content-container {
                flex-direction: column;
            }
        }

        @media (max-width: 767px) {
            .calendar-container, .list-container {
                padding: 1rem;
            }

            .project-card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .list-filter-controls {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
            }

            .detail-row {
                flex-direction: column;
            }

            .detail-label {
                width: 100%;
                margin-bottom: 0.2rem;
            }

            .projects-grid {
                grid-template-columns: 1fr;
            }

            #teamManagementTabs .nav-link {
                padding: 0.5rem;
                font-size: 0.85rem;
            }

            .team-card-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media (min-width: 992px) {
            .calendar-container, .list-container {
                padding: 2rem;
            }
        }

        /* Custom FullCalendar styles */
        .fc .fc-toolbar-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--lighter-text);
        }

        .fc .fc-button {
            background-color: rgba(15, 25, 35, 0.7);
            border-color: var(--primary-blue);
            color: var(--primary-blue);
            font-weight: 500;
            text-transform: capitalize;
            transition: all 0.3s ease;
        }

        .fc .fc-button:hover {
            background-color: rgba(44, 90, 160, 0.1);
            border-color: var(--primary-blue);
            color: var(--accent-blue);
        }

        .fc .fc-button-primary:not(:disabled).fc-button-active {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
            color: white;
        }

        .fc .fc-daygrid-day-number {
            color: var(--light-text);
            font-weight: 500;
        }

        .fc .fc-daygrid-day.fc-day-today {
            background-color: rgba(58, 123, 213, 0.2);
        }

        .fc .fc-daygrid-day.fc-day-today .fc-daygrid-day-number {
            color: var(--accent-blue);
            font-weight: 700;
        }

        .fc .fc-event {
            border: none;
            padding: 1px 3px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.9;
        }

        .fc .fc-event:hover {
            opacity: 1;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* Completed events style */
        .fc .fc-event.completed {
            text-decoration: line-through;
            opacity: 0.8;
        }

        /* Estilos para eventos compactos pero con más presencia */
        .fc .fc-event {
            padding: 4px 4px !important;
            margin: 2px 1px !important;
            min-height: 24px !important;
            line-height: 1.4 !important;
            font-size: 0.85rem !important;
        }

        .fc .fc-event .fc-event-main {
            height: 100% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        /* Líneas internas */
        .fc .fc-daygrid-day {
            border: 1px solid rgba(44, 90, 160, 0.1) !important;
        }

        /* Contorno externo */
        .fc .fc-scrollgrid {
            border: 1px solid rgba(44, 90, 160, 0.1) !important;
        }

        /* Encabezado (días de la semana) */
        .fc .fc-col-header-cell {
            border: 1px solid rgba(44, 90, 160, 0.1) !important;
            color: white;
            background-color: var(--darker-bg);
        }

        /* Week Table View */
        .fc-week-table-view {
            width: 100%;
            overflow-x: auto;
        }

        .fc-week-table {
            width: 100%;
            border-collapse: collapse;
            background-color: rgba(15, 25, 35, 0.7);
            border-radius: 10px;
            overflow: hidden;
        }

        .fc-week-table th,
        .fc-week-table td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .fc-week-table th {
            background-color: var(--darker-bg);
            color: var(--lighter-text);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .fc-week-table td {
            vertical-align: middle;
            height: 80px;
        }

        .project-name-cell {
            text-align: left !important;
            padding-left: 16px !important;
            font-weight: 500;
            color: var(--lighter-text);
            white-space: nowrap;
            min-width: 200px;
        }

        .project-day-cell {
            position: relative;
        }

        .day-indicator {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .day-indicator.in-progress {
            background-color: rgba(44, 90, 160, 0.2);
            color: var(--primary-blue);
            border: 2px solid var(--primary-blue);
        }

        .day-indicator.completed {
            background-color: rgba(108, 117, 125, 0.2);
            color: #6c757d;
            border: 2px solid #6c757d;
        }

        .day-indicator.cancelled {
            background-color: rgba(255, 77, 77, 0.2);
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
        }

        .project-name-cell.in-progress {
            border-left: 4px solid var(--primary-blue);
        }

        .project-name-cell.completed {
            border-left: 4px solid #6c757d;
        }

        .project-name-cell.cancelled {
            border-left: 4px solid var(--danger-color);
        }

        .fc-week-table tr:hover td {
            background-color: rgba(44, 90, 160, 0.1);
            cursor: pointer;
        }

        /* Ajustes para pantallas más pequeñas */
        @media (max-width: 992px) {
            .fc-week-table th,
            .fc-week-table td {
                padding: 8px 10px;
            }

            .project-name-cell {
                min-width: 150px;
            }
        }

        @media (max-width: 768px) {
            .fc-week-table {
                min-width: 600px;
            }

            .day-indicator {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
        }

        .calendar-scroll-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Para scroll suave en iOS */
            padding-bottom: 10px; /* Espacio para la barra de scroll */
        }

        #calendar {
            min-width: 1000px; /* O el ancho mínimo que necesites */
            width: 100%;
        }

        .fc-week-table-view {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            width: 100%;
        }

        .fc-week-table {
            min-width: 800px; /* O el ancho que necesites */
            width: 100%;
        }

        @media (max-width: 767px) {
            .fc .fc-toolbar {
                flex-wrap: wrap;
            }

            .fc .fc-toolbar-title {
                font-size: 1.1rem;
                margin: 5px 0;
            }
        }

        /* Estilos responsivos para el calendario */
        .fc .fc-view-harness {
            min-height: 400px;
        }

        .fc .fc-daygrid-day-frame {
            min-height: 80px; /* Altura mínima de las celdas */
            display: flex;
            flex-direction: column;
        }

        .fc .fc-daygrid-day-top {
            flex-direction: column;
            align-items: flex-start;
            padding: 2px 4px;
        }

        .fc .fc-daygrid-day-number {
            font-size: 0.9rem;
            padding: 2px;
        }

        .fc .fc-daygrid-day-events {
            flex-grow: 1;
            margin: 2px 0;
            min-height: 0;
        }

        .fc .fc-event {
            margin: 1px 0;
            padding: 2px 4px;
            font-size: 0.8rem;
            border-radius: 3px;
        }

        .fc .fc-daygrid-event-harness {
            margin-bottom: 2px;
        }

        /* Ajustes para pantallas pequeñas */
        @media (max-width: 768px) {
            .fc .fc-toolbar {
                flex-direction: column;
                align-items: flex-start;
            }

            .fc .fc-toolbar-title {
                font-size: 1.2rem;
                margin: 5px 0;
            }

            .fc .fc-button {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
                margin: 2px;
            }

            .fc .fc-daygrid-day-frame {
                min-height: 60px;
            }

            .fc .fc-daygrid-day-number {
                font-size: 0.7rem;
            }

            .fc .fc-event {
                font-size: 0.7rem;
                padding: 1px 2px;
            }
        }


        .fc .fc-toolbar-title {
            font-size: clamp(1rem, 2vw, 1.5rem);
        }

        /* Elimina márgenes/paddings en móvil */
        @media (max-width: 767px) {
            .container {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .main-content-container,
            .calendar-container,
            .calendar-scroll-wrapper {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }
        }

        /* En tu archivo CSS */
        .container {
            width: 100%;
            max-width: 100%;
            padding: 0 15px;
            margin: 0 auto;
        }

        @media (min-width: 992px) { /* Solo para desktop */
            .container {
                max-width: 95%; /* O el porcentaje que prefieras */
            }
        }


        /* Estilos para la vista semanal (weekTable) */
        .fc-week-table-view {
            width: 100% !important;
            overflow-x: visible !important;
        }

        .fc-week-table {
            width: 100% !important;
            min-width: auto !important;
            table-layout: fixed !important;
        }

        .fc-week-table th,
        .fc-week-table td {
            width: 14.28% !important; /* 100% / 7 días */
            max-width: 14.28% !important;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .project-name-cell {
            width: 200px !important;
            min-width: 200px !important;
            max-width: 200px !important;
        }

        /* Ajustes para pantallas más pequeñas */
        @media (max-width: 1200px) {
            .fc-week-table th,
            .fc-week-table td {
                padding: 8px 4px !important;
                font-size: 0.8rem !important;
            }

            .project-name-cell {
                width: 150px !important;
                min-width: 150px !important;
                max-width: 150px !important;
            }
        }

        @media (max-width: 992px) {
            .fc-week-table th,
            .fc-week-table td {
                padding: 6px 2px !important;
            }

            .day-indicator {
                width: 24px !important;
                height: 24px !important;
                font-size: 0.7rem !important;
            }

            .project-name-cell {
                width: 120px !important;
                min-width: 120px !important;
                max-width: 120px !important;
            }
        }

        @media (max-width: 768px) {
            .fc-week-table {
                min-width: 600px !important; /* Mínimo para que sea legible */
            }

            .fc-week-table-view {
                overflow-x: auto !important; /* Permitir scroll solo en móvil */
            }
        }
        .calendar-container {
            width: 100%;
            overflow: visible;
        }

        .calendar-scroll-wrapper {
            width: 100%;
            overflow: visible;
        }

        #calendar {

            min-width: auto !important;
        }

        /* Añade estos estilos al final de tu sección CSS */

        /* Estilos responsivos para la vista semanal */
        @media (max-width: 1200px) {
            .fc-week-table th,
            .fc-week-table td {
                padding: 6px 3px !important;
                font-size: 0.75rem !important;
            }

            .project-name-cell {
                width: 120px !important;
                min-width: 120px !important;
                max-width: 120px !important;
                font-size: 0.8rem !important;
                padding-left: 8px !important;
            }

            .day-indicator {
                width: 22px !important;
                height: 22px !important;
                font-size: 0.65rem !important;
            }
        }

        @media (max-width: 992px) {
            .fc-week-table th,
            .fc-week-table td {
                padding: 4px 2px !important;
                font-size: 0.7rem !important;
            }

            .project-name-cell {
                width: 100px !important;
                min-width: 100px !important;
                max-width: 100px !important;
                font-size: 0.75rem !important;
            }

            .day-indicator {
                width: 20px !important;
                height: 20px !important;
            }
        }

        @media (max-width: 768px) {
            .fc-week-table {
                min-width: 100% !important;
            }

            .fc-week-table th,
            .fc-week-table td {
                padding: 3px 1px !important;
                font-size: 0.65rem !important;
            }

            .project-name-cell {
                width: 80px !important;
                min-width: 80px !important;
                max-width: 80px !important;
                font-size: 0.7rem !important;
                padding-left: 5px !important;
            }

            .day-indicator {
                width: 18px !important;
                height: 18px !important;
                font-size: 0.6rem !important;
            }

            .fc-week-table-view {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch;
            }
        }

        @media (max-width: 576px) {
            .fc-week-table th,
            .fc-week-table td {
                padding: 2px 0 !important;
            }

            .project-name-cell {
                width: 70px !important;
                min-width: 70px !important;
                max-width: 70px !important;
                font-size: 0.65rem !important;
            }

            .day-indicator {
                width: 30px !important;
                height: 30px !important;
            }
        }

        /* Estilos corregidos para el calendario - manteniendo líneas divisorias pero con el color correcto */

        /* Contenedor principal - eliminar bordes blancos externos */
        .fc .fc-scrollgrid {
            border: 1px solid var(--border-color) !important; /* Mantener borde exterior con color del tema */
        }

        /* Cabeceras de días (Lunes, Martes, etc.) */
        .fc .fc-col-header-cell {
            border: 1px solid var(--border-color) !important;
            background-color: var(--darker-bg) !important;
            color: white !important;
        }

        /* Celdas de días */
        .fc .fc-daygrid-day {
            border: 1px solid var(--border-color) !important;
            background-color: rgba(15, 25, 35, 0.7) !important;
        }

        /* Eliminar bordes internos duplicados */
        .fc .fc-daygrid-day-frame {
            border: none !important;
        }

        /* Eliminar bordes blancos entre celdas */
        .fc .fc-scrollgrid-section-body td,
        .fc .fc-scrollgrid-section-footer td {
            border-left: 1px solid var(--border-color) !important;
            border-right: 1px solid var(--border-color) !important;
            border-bottom: 1px solid var(--border-color) !important;
            border-top: none !important;
        }

        /* Ajustar el borde superior de la primera fila */
        .fc .fc-scrollgrid-section-body tr:first-child td {
            border-top: 1px solid var(--border-color) !important;
        }

        /* Asegurar que el fondo del calendario coincida con tu tema */
        .fc .fc-view-harness {
            background-color: rgba(15, 25, 35, 0.8);
        }

        /* Estilo para el día actual */
        .fc .fc-daygrid-day.fc-day-today {
            background-color: rgba(58, 123, 213, 0.2) !important;
        }

        /* Eliminar cualquier espacio adicional no deseado */
        .fc .fc-scrollgrid-liquid {
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Ajustar el contenedor principal del calendario */
        #calendar {
            background-color: rgba(15, 25, 35, 0.8);
            border-radius: 10px;
            overflow: hidden;
        }

        /* Efecto hover para celdas del calendario */
        .fc .fc-daygrid-day:hover {
            background-color: rgba(44, 90, 160, 0.3) !important; /* Color azul suave */
            transition: background-color 0.3s ease; /* Transición suave */
            cursor: pointer; /* Cambia el cursor a pointer */
        }

        /* Efecto hover para el encabezado de columnas (días de la semana) */
        .fc .fc-col-header-cell:hover {
            background-color: rgba(44, 90, 160, 0.2) !important;
        }

        /* Efecto hover para eventos dentro de las celdas */
        .fc .fc-event:hover {
            opacity: 1 !important;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.5) !important;
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        /* Efecto hover para el día actual */
        .fc .fc-daygrid-day.fc-day-today:hover {
            background-color: rgba(58, 123, 213, 0.3) !important;
        }

        /* Members Section Styles */
        .members-section {
            margin-bottom: 1.5rem;
            border-radius: 6px;
            overflow: hidden;
            background-color: rgba(15, 25, 35, 0.5);
            border: 1px solid var(--border-color);
        }

        .members-section-label {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
        }

        .members-section-label span {
            position: relative;
            padding-left: 1.5rem;
        }

        .members-section-label span::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Confirmed Members */
        .confirmed-label {
            background-color: rgba(56, 176, 0, 0.1);
            border-bottom: 1px solid rgba(56, 176, 0, 0.3);
            color: var(--completed-color);
        }

        .confirmed-label span::before {
            background-color: var(--completed-color);
        }

        /* Pending Members */
        .pending-label {
            background-color: rgba(44, 90, 160, 0.1);
            border-bottom: 1px solid rgba(44, 90, 160, 0.3);
            color: var(--primary-blue);
        }

        .pending-label span::before {
            background-color: var(--primary-blue);
        }

        /* Rejected Members */
        .rejected-label {
            background-color: rgba(255, 77, 77, 0.1);
            border-bottom: 1px solid rgba(255, 77, 77, 0.3);
            color: var(--danger-color);
        }

        .rejected-label span::before {
            background-color: var(--danger-color);
        }

        /* Members List inside sections */
        .members-section .members-list {
            padding: 0.75rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        /* Member Item adjustments */
        .members-section .member-item {
            background-color: rgba(15, 25, 35, 0.7);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .members-section .member-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .members-section .members-list {
                gap: 0.5rem;
            }
            
            .members-section-label {
                padding: 0.4rem 0.8rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>

<!-- Imagen -->
<div class="bg-fast-load">
    <img
            src="/img/admrescale.webp"
            srcset="
     /img/admrescale.webp?width=600 600w,
      /img/admrescale.webp?width=1200 1200w,
      /img/admrescale.webp?width=1800 1800w
    "
            sizes="100vw"
            alt=""
            decoding="async"
    >
</div>


<!-- Success Notification -->
<div id="successNotification" class="alert alert-success success-notification" role="alert" style="display: none;">
    <div class="success-notification-content">
        <i class="fas fa-check-circle success-icon"></i>
        <div class="success-message">
            <div class="success-title" th:text="#{project-created}">Project created.</div>
            <div class="success-detail" th:text="#{album-created-success}">The album has been created successfully.</div>
        </div>
        <span class="success-close" onclick="hideSuccessNotification()">&times;</span>
    </div>
</div>

<!-- Agenda Header -->
<div class="agenda-header text-center">
    <div class="container agenda-header-content">
        <h1 class="agenda-title"><i class="fas fa-calendar-alt me-3"></i> <span th:text="#{projects-agenda}">Projects Agenda</span></h1>
        <p class="agenda-description" th:text="#{organize-manage-projects}">Organize and manage all your projects</p>
        <div class="button-group" th:if="${AGENDA_CREATE}">
            <button type="button" class="btn btn-primary btn-rounded" id="btnOpenModal">
                <i class="fas fa-plus"></i> <span th:text="#{new-project}">New Project</span>
            </button>
            <button type="button" class="btn btn-secondary btn-rounded" id="toggleCalendarBtn" hidden="true">
                <i class="fas fa-calendar"></i> <span th:text="#{show-calendar}">Show Calendar</span>
            </button>
            <button type="button" class="btn btn-success btn-rounded" id="showCompletedBtn">
                <i class="fas fa-check-circle"></i> <span th:text="#{view-completed}">View Completed</span>
            </button>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div class="toast-container">
    <div id="successToast" class="toast toast-success" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">Success</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            <i class="fas fa-check-circle me-2"></i>
            <span id="toastMessage">Operation completed successfully</span>
        </div>
    </div>

</div>


<!-- Main Content -->
<div class="container">
    <div class="main-content-container">

        <div th:replace="permiso/permissions-panel :: panelPermisos"></div>

        <!-- Calendar Section (hidden by default) -->
        <div class="calendar-container" id="calendarSection" >
            <div class="calendar-scroll-wrapper">
                <div id="calendar"></div>
            </div>
        </div>
        <!-- Project Table week -->
        <div id="projectTableContainer" style="margin-top: 20px;"></div>
    </div>

    <!-- List Section -->
    <div class="list-section">
        <div class="list-container">
            <div class="list-view-header">
                <h3 class="list-view-title"><i class="fa-solid fa-folder-open"></i> <span th:text="#{my-projects}">My Projects</span></h3>
                <div class="list-filter-controls">
                    <span class="filter-label" th:text="#{sort-by}">Sort by:</span>
                    <select id="sortProjects" class="filter-select">
                        <option value="name-asc" th:text="#{name-asc}">Name (A-Z)</option>
                        <option value="name-desc" th:text="#{name-desc}">Name (Z-A)</option>
                    </select>
                </div>
            </div>

            <!-- Search Box -->
            <div class="search-box">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" id="projectSearch" th:placeholder="#{search-projects}">
                </div>
            </div>

            <div id="projectsContainer">
                <!-- Active Projects Section -->
                <div id="activeProjects">
                    <h4 class="section-title mb-3"><i class="fa-regular fa-folder-open"></i> <span th:text="#{active-projects}">Active Projects</span></h4>
                    <div class="projects-grid">
                        <!-- Active projects card (pending status) -->
                        <div class="project-card pendiente"
                             th:each="album : ${albumes}"
                             th:if="${album.estado} == 'pendiente'"
                             th:attr="data-id=${album.id}, data-status=${album.estado}">
                            <div class="project-card-header">
                                <div class="project-card-content" onclick="showAlbumDetailsById(this.parentElement.parentElement.getAttribute('data-id'))">
                                    <h4 class="project-card-title" th:text="${album.nombre}">
                                        <span class="status-badge status-pending" th:text="#{pending}">Pending</span>
                                    </h4>
                                    <div class="project-card-date">
                                        <i class="far fa-clock"></i>
                                        <span th:if="${album.fechaInicio}" th:text="${#temporals.format(album.fechaInicio, 'dd/MM/yyyy')}">Date</span>
                                        <span th:unless="${album.fechaInicio}" th:text="#{no-date}">No date</span>
                                    </div>
                                </div>
                                <div class="project-actions">
                                    <button class="action-btn btn-edit"
                                            th:if="${AGENDA_EDIT}"
                                            onclick="editAlbum(event, this.closest('.project-card').getAttribute('data-id'))">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn btn-delete"
                                            th:if="${AGENDA_DELETE}"
                                            th:attr="data-id=${album.id}"
                                            onclick="deleteAlbum(event, this.getAttribute('data-id'))">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="project-card-body">
                                <p class="project-card-description" th:text="${album.descripcion} ?: #{no-description-available}">Project description</p>
                                <div class="project-card-footer">
                                    <button class="btn btn-sm btn-outline-primary" onclick="showAlbumDetailsById(this.closest('.project-card').getAttribute('data-id'))">
                                        <i class="fas fa-eye me-1"></i> <span th:text="#{view-details}">View Details</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Archived Projects Section -->
                <div id="archivedProjects" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="section-title mb-0"><i class="fas fa-archive me-2"></i> <span th:text="#{archived-projects}">Archived Projects</span></h4>
                        <!--                            <button class="btn btn-sm btn-outline-secondary" onclick="toggleArchivedProjects()">-->
                        <!--                                <i class="fas fa-times"></i> Hide-->
                        <!--                            </button>-->
                    </div>
                    <div class="projects-grid">
                        <!-- Completed/Cancelled projects card -->
                        <div class="project-card"
                             th:each="album : ${albumes}"
                             th:if="${album.estado} != 'pendiente'"
                             th:attr="data-id=${album.id}, data-status=${album.estado}"
                             th:classappend="${album.estado}">
                            <div class="project-card-header">
                                <div class="project-card-content" onclick="showAlbumDetailsById(this.parentElement.parentElement.getAttribute('data-id'))">
                                    <h4 class="project-card-title" th:text="${album.nombre}">
                                    <span th:classappend="${album.estado} == 'completado' ? 'status-badge status-completed' :
                                          ${album.estado} == 'anulado' ? 'status-badge status-cancelled' :
                                          'status-badge status-pending'">
                                        <span th:text="${album.estado} == 'completado' ? 'Completed' :
                                                  ${album.estado} == 'anulado' ? 'Cancelled' : 'Pending'">
                                        </span>
                                    </span>
                                    </h4>
                                    <div class="project-card-date">
                                        <i class="far fa-clock"></i>
                                        <span th:if="${album.fechaInicio}" th:text="${#temporals.format(album.fechaInicio, 'dd/MM/yyyy')}">Date</span>
                                        <span th:unless="${album.fechaInicio}">No date</span>
                                    </div>
                                </div>
                                <div class="project-actions">
                                    <button class="action-btn btn-edit"
                                            th:if="${AGENDA_EDIT}"
                                            onclick="editAlbum(event, this.closest('.project-card').getAttribute('data-id'))">
                                        <i class="fas fa-edit"></i>
                                    </button>

                                    <button class="action-btn btn-delete"
                                            th:if="${AGENDA_DELETE}"
                                            th:attr="data-id=${album.id}"
                                            onclick="deleteAlbum(event, this.getAttribute('data-id'))">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>

                            </div>
                            <div class="project-card-body">
                                <p class="project-card-description" th:text="${album.descripcion} ?: 'No description available'">Project description</p>
                                <div class="project-card-footer">
                                    <button class="btn btn-sm btn-outline-primary" onclick="showAlbumDetailsById(this.closest('.project-card').getAttribute('data-id'))">
                                        <i class="fas fa-eye me-1"></i> View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty state -->
                <div class="empty-state" th:if="${#lists.isEmpty(albumes)}">
                    <i class="fas fa-folder-open"></i>
                    <h4 th:text="#{no-projects-created}">No projects created</h4>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- Project creation modal -->
<div class="modal fade" id="projectModal" tabindex="-1" aria-labelledby="projectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="projectModalLabel">
                    <i class="fas fa-plus-circle"></i> <span th:text="#{new-project}">Create New Project</span>
                </h5>
            </div>
            <form id="projectForm" th:action="@{/albumes/save}" method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="nombre" class="form-label" th:text="#{project-name} + ' *'">Project Name *</label>
                            <input type="text" class="form-control" id="nombre" name="nombre"
                                   th:placeholder="#{name-of-your-new-project}" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="descripcion" class="form-label" th:text="#{description}">Description</label>
                        <textarea class="form-control" id="descripcion" name="descripcion" rows="4"
                                  th:placeholder="#{describe-project-content-optional}"></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="fechaInicio" class="form-label" th:text="#{start-date}">Start Date</label>
                            <input type="date" class="form-control" id="fechaInicio" name="fechaInicio">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="horaInicio" class="form-label" th:text="#{start-time-optional}">Start Time (optional)</label>
                            <input type="time" class="form-control" id="horaInicio" name="horaInicio">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="fechaFin" class="form-label" th:text="#{end-date}">End Date</label>
                            <input type="date" class="form-control" id="fechaFin" name="fechaFin">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="horaFin" class="form-label" th:text="#{end-time-optional}">End Time (optional)</label>
                            <input type="time" class="form-control" id="horaFin" name="horaFin">
                            <small class="text-muted" th:text="#{if-not-specified-all-day}">If not specified, the project will last all day</small>
                        </div>
                    </div>

                    <div>
                        <label for="notas" class="form-label" th:text="#{notes}">Notes</label>
                        <input type="text" class="form-control" id="notas" name="notas" th:placeholder="#{additional-notes}">
                    </div>


                    <div class="mb-3">
                        <label for="ubicacion" class="form-label" th:text="#{location}">Location</label>
                        <input type="text" class="form-control" id="ubicacion" name="ubicacion" th:placeholder="#{project-address}">
                    </div>

                    <div class="mb-3">
                        <label for="contacto" class="form-label" th:text="#{contact}">Contact</label>
                        <input type="text" class="form-control" id="contacto" name="contacto" th:placeholder="#{project-contact-details}">
                    </div>

                    <div class="mb-3">
                        <label for="claveAlarma" class="form-label" th:text="#{alarm-code}">Alarm Code</label>
                        <input type="text" class="form-control" id="claveAlarma" name="claveAlarma" th:placeholder="#{alarm-security-code-if-any}">
                    </div>

                    <div class="mb-3">
                        <label for="datosAdicionales" class="form-label" th:text="#{additional-data}">Additional Data</label>
                        <textarea class="form-control" id="datosAdicionales" name="datosAdicionales" rows="4"
                                  th:placeholder="#{any-additional-information-about-project}"></textarea>
                    </div>

                    <div class="row" th:if="${userRole == 'EDGAR'}">
                        <div class="col-md-6 mb-3">
                            <label for="horasPorProyecto" class="form-label" th:text="#{hours-per-project}">Hours per Project</label>
                            <input type="number" class="form-control" id="horasPorProyecto" name="horasPorProyecto" step="0.1"
                                   th:placeholder="#{total-hours-dedicated-to-project}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="precioHora" class="form-label" th:text="#{price-per-hour}">Price per Hour</label>
                            <input type="number" class="form-control" id="precioHora" name="precioHora" step="0.01"
                                   th:placeholder="#{price-per-hour-for-project}">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" th:text="#{close}">Close</button>
                    <button type="submit" class="btn btn-primary" th:text="#{save-project}">Save Project</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Album details modal -->
<div class="modal fade" id="albumDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-project-diagram"></i>
                    <span id="albumDetailsModalLabel">Project Details</span>
                </h5>
            </div>
            <div class="modal-body detail-modal-body">
                <div class="detail-section">
                    <h5 th:text="#{basic-information}">Basic Information</h5>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{project-name}">Name:</div>
                        <div class="detail-value" id="detail-nombre">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{description}">Description:</div>
                        <div class="detail-value" id="detail-descripcion">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{status}">Status:</div>
                        <div class="detail-value" id="detail-estado">-</div>
                    </div>
                </div>

                <div class="detail-section">
                    <h5 th:text="#{dates}">Dates</h5>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{start-date}">Start Date:</div>
                        <div class="detail-value" id="detail-fechaInicio">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{start-time}">Start Time:</div>
                        <div class="detail-value" id="detail-horaInicio">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{end-date}">End Date:</div>
                        <div class="detail-value" id="detail-fechaFin">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{end-time}">End Time:</div>
                        <div class="detail-value" id="detail-horaFin">-</div>
                    </div>
                </div>

                <div class="detail-section">
                    <h5 th:text="#{location-contact}">Location and Contact</h5>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{location}">Location:</div>
                        <div class="detail-value" id="detail-ubicacion">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{contact}">Contact:</div>
                        <div class="detail-value" id="detail-contacto">-</div>
                    </div>
                </div>

                <div class="detail-section">
                    <h5 th:text="#{additional-information}">Additional Information</h5>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{alarm-code}">Alarm Code:</div>
                        <div class="detail-value" id="detail-claveAlarma">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{notes}">Notes:</div>
                        <div class="detail-value" id="detail-notas">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label" th:text="#{additional-data}">Additional Data:</div>
                        <div class="detail-value" id="detail-datosAdicionales">-</div>
                    </div>
                    <div class="detail-row admin-only" th:classappend="${userRole != 'EDGAR'} ? 'd-none' : ''">
                        <div class="detail-label" th:text="#{hours-per-project}">Hours per Project:</div>
                        <div class="detail-value" id="detail-horasPorProyecto">-</div>
                    </div>
                    <div class="detail-row admin-only" th:classappend="${userRole != 'EDGAR'} ? 'd-none' : ''">
                        <div class="detail-label" th:text="#{price-per-hour}">Price per Hour:</div>
                        <div class="detail-value" id="detail-precioHora">-</div>
                    </div>
                </div>
            </div>

            <div class="modal-footer d-flex justify-content-between align-items-center flex-wrap">
                <!-- Botones de cambio de estado -->
                <div class="status-change-buttons mb-2 mb-sm-0" id="statusChangeButtons"
                     th:if="${AGENDA_STATUS}">
                    <!-- Se insertarán dinámicamente -->
                </div>

                <!-- Botones de acción -->
                <div class="action-buttons text-end">
                    <button type="button" class="btn btn-success me-2" onclick="generatePdf()"
                            th:if="${AGENDA_PDF}">
                        <i class="fas fa-file-pdf me-1"></i> <span th:text="#{generate-pdf}">Generate PDF</span>
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><span th:text="#{close}">Close</span></button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Delete confirmation modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i> <span th:text="#{confirm-delete-project}">Confirm Deletion</span></h5>
            </div>
            <div class="modal-body">
                <p th:text="#{delete-project-confirmation}">Are you sure you want to delete this project? This action cannot be undone.</p>
                <p class="fw-bold" th:text="#{delete-associated-content}">All associated subprojects and photos will also be deleted.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" th:text="#{cancel}">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" th:text="#{delete}">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Context Menu for Calendar Events -->
<div id="contextMenu" class="context-menu">
    <div class="context-menu-item" onclick="openDetailsFromContextMenu()">
        <i class="fas fa-eye"></i> <span th:text="#{contextMenu.viewDetails}">View Details</span> </div>

    <div class="context-menu-item" onclick="openNotesFromContextMenu()" th:if="${AGENDA_NOTES}">
        <i class="fas fa-edit"></i> <span th:text="#{contextMenu.viewEditNotes}">View/Edit Notes</span> </div>

    <div class="context-menu-item" onclick="createTeamForProjectFromContextMenu()" th:if="${AGENDA_TEAMS}">
        <i class="fas fa-users"></i> <span th:text="#{contextMenu.viewCreateTeam}">View/Create Team</span> </div>
</div>

<!-- Create Team Modal -->
<div class="modal fade" id="createTeamModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" th:text="#{team-management}">Team Management:</h5> <span id="current-project-name"></span>
            </div>

            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="teamManagementTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="create-team-tab" data-bs-toggle="tab" data-bs-target="#create-team" type="button" role="tab" aria-controls="create-team" aria-selected="true">
                        <i class="fas fa-plus-circle me-2"></i> <span th:text="#{create-team}">Create Team</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="view-teams-tab" data-bs-toggle="tab" data-bs-target="#view-teams" type="button" role="tab" aria-controls="view-teams" aria-selected="false">
                        <i class="fas fa-users me-2"></i> <span th:text="#{view-teams}">View Teams</span> (<span id="teams-count">0</span>)
                    </button>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="modal-body tab-content">
                <!-- Create Team Tab -->
                <div class="tab-pane fade show active" id="create-team" role="tabpanel" aria-labelledby="create-team-tab">
                    <div class="team-form">
                        <div class="mb-3">
                            <label for="team-name" class="form-label" th:text="#{team-name}">Team Name</label>
                            <input type="text" class="form-control mobile-form-control" id="team-name" th:placeholder="#{team-name-example}">
                        </div>
                        <div class="mb-3">
                            <label for="team-description" class="form-label" th:text="#{team-description}">Description (Optional)</label>
                            <textarea class="form-control mobile-form-control" id="team-description" rows="2"
                                      th:placeholder="#{team-description-example}"></textarea>
                        </div>

                        <div class="mb-4">
                            <label class="form-label" th:text="#{team-members}">Team Members</label>
                            <small class="text-muted d-block mb-2" th:text="#{team-members-hint}">You can add team members by selecting them from the list below.</small>

                            <div class="selection-list" id="available-employees">
                                <!-- Employees will be loaded dynamically -->
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary mobile-btn touch-feedback" data-bs-dismiss="modal" th:text="#{cancel}">Cancel</button>
                            <button id="save-team-btn" class="btn btn-primary" disabled>
                                <i class="fas fa-save me-2"></i> <span th:text="#{save-team}">Save Team</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- View Teams Tab -->
                <div class="tab-pane fade" id="view-teams" role="tabpanel" aria-labelledby="view-teams-tab">
                    <div class="teams-list-container" id="project-teams-list">
                        <div class="text-center py-5 loading-teams">
                            <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                            <p class="mt-3" th:text="#{loading-teams}">Loading teams...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal for Duplicate Members -->
<div class="modal fade" id="duplicateMemberModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title text-white"><i class="fas fa-exclamation-triangle me-2"></i>Duplicate Member</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="duplicate-member-message"></p>
                <p>Do you want to continue adding this member to multiple teams?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-duplicate-member">Continue</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Editor Modal -->
<div class="modal fade" id="notesModal" tabindex="-1" aria-labelledby="notesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="notesModalLabel">
                    <i class="fas fa-sticky-note me-2"></i> <span th:text="#{project-notes}">Project Notes</span>
                </h5>
            </div>
            <div class="modal-body">
                <textarea id="notesEditor" class="form-control" rows="10"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" th:text="#{cancel}">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveNotes()" th:text="#{save-notes}">Save Notes</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmación para eliminar -->
<div class="modal fade" id="confirmDeleteModalteam" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i> <span th:text="#{confirm-delete-project}">Confirm Deletion</span></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p th:text="#{delete-project-confirmation}">Are you sure you want to delete this project? This action cannot be undone.</p>
                <p class="fw-bold" th:text="#{delete-associated-content}">All associated subprojects and photos will also be deleted.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete Team</button>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const hasStatusPermission = [[${AGENDA_STATUS}]];
</script>


<!-- Script para manejar la visibilidad de elementos según el rol -->
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {


        const btnOpenModal = document.getElementById('btnOpenModal');
        const projectModal = new bootstrap.Modal(document.getElementById('projectModal'));

        btnOpenModal.addEventListener('click', function() {
            // Resetear las fechas cuando se abre el modal manualmente
            document.getElementById('fechaInicio').value = '';
            document.getElementById('fechaFin').value = '';

            // Restaurar título por defecto
            document.getElementById('projectModalLabel').innerHTML =
                '<i class="fas fa-plus-circle"></i> Crear Nuevo Proyecto';

            projectModal.show();
        });



        // Ocultar campos de horas y precio si el usuario no es ADMIN
        const userRole = /*[[${userRole}]]*/ 'USUARIO';
        if (userRole !== 'EDGAR') {
            document.querySelectorAll('.admin-only').forEach(el => {
                el.classList.add('d-none');
            });
        }
    });

</script>


<!-- Bootstrap core JavaScript -->
<script th:src="@{/vendor/jquery/jquery.min.js}"></script>
<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>

<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/es.min.js"></script>

<script>
    // Variables globales
    let currentAlbumId = null;
    const albumDetailsModal = new bootstrap.Modal(document.getElementById('albumDetailsModal'));
    let calendar;
    let selectedColor = '#4361ee';
    let calendarVisible = false;
    let projectModal = null;

    // Función para configurar el cierre limpio del modal
    function setupModalCleanClose() {
        const modalElement = document.getElementById('projectModal');

        // Limpiar cualquier evento existente
        const closeButtons = modalElement.querySelectorAll('[data-bs-dismiss="modal"], .btn-close');
        closeButtons.forEach(btn => {
            btn.removeEventListener('click', handleModalClose);
            btn.addEventListener('click', handleModalClose);
        });

        // Manejar el evento hidden.bs.modal
        modalElement.removeEventListener('hidden.bs.modal', cleanModalBackdrop);
        modalElement.addEventListener('hidden.bs.modal', cleanModalBackdrop);
    }

    // Función para manejar el cierre del modal
    function handleModalClose(e) {
        e.preventDefault();
        cleanCloseModal(projectModal);
    }

    // Función para cerrar el modal limpiamente
    function cleanCloseModal(modalInstance) {
        if (modalInstance) {
            modalInstance.hide();
        }
        cleanModalBackdrop();
    }

    // Función para limpiar el backdrop y restaurar el body
    function cleanModalBackdrop() {
        // Eliminar manualmente el backdrop si existe
        const backdrop = document.querySelector('.modal-backdrop');
        if (backdrop) {
            backdrop.remove();
        }

        // Restaurar el scroll del body
        document.body.style.overflow = 'auto';
        document.body.style.paddingRight = '0';
        document.body.classList.remove('modal-open');
    }

    // Inicialización del modal
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar FullCalendar
        initCalendar();

        // Verificar que Bootstrap esté cargado
        if (typeof bootstrap !== 'undefined') {
            console.log("Bootstrap cargado correctamente");

            // Control manual del modal de creación
            const btnOpenModal = document.getElementById('btnOpenModal');
            projectModal = new bootstrap.Modal(document.getElementById('projectModal'), {
                backdrop: true,
                keyboard: true,
                focus: true
            });

            // Configurar el cierre limpio del modal
            setupModalCleanClose();

            btnOpenModal.addEventListener('click', function() {
                // Resetear las fechas cuando se abre el modal manualmente
                document.getElementById('fechaInicio').value = '';
                document.getElementById('fechaFin').value = '';
                projectModal.show();
            });

            // Manejo del formulario
            document.getElementById('projectForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const formData = new FormData(this);

                fetch(this.action, {
                    method: 'POST',
                    body: formData
                })
                    .then(response => {
                        if (!response.ok) throw new Error('Error en la respuesta');
                        return response.text();
                    })
                    .then(text => {
                        if (text === "Álbum guardado con éxito") {
                            showNotification();
                            this.reset();
                            cleanCloseModal(projectModal);

                            // Recargar después de 1 segundo
                            setTimeout(() => {
                                window.location.reload();
                            }, 1000);
                        } else {
                            alert("Error: " + text);
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("Error al guardar el proyecto");
                    });
            });

            // Búsqueda de proyectos
            document.getElementById('projectSearch').addEventListener('input', function(e) {
                const searchTerm = this.value.toLowerCase().trim();
                const projects = document.querySelectorAll('.project-card');

                projects.forEach(project => {
                    const title = project.querySelector('.project-card-title').textContent.toLowerCase();
                    const description = project.querySelector('.project-card-description') ?
                        project.querySelector('.project-card-description').textContent.toLowerCase() : '';

                    if (searchTerm === '' || title.includes(searchTerm) || description.includes(searchTerm)) {
                        project.style.display = 'block';
                    } else {
                        project.style.display = 'none';
                    }
                });
            });

            // Ordenar proyectos
            document.getElementById('sortProjects').addEventListener('change', function() {
                const sortValue = this.value;
                const container = document.querySelector('.projects-grid');
                const projects = Array.from(document.querySelectorAll('.project-card'));

                projects.sort((a, b) => {
                    const titleA = a.querySelector('.project-card-title').textContent.toLowerCase();
                    const titleB = b.querySelector('.project-card-title').textContent.toLowerCase();

                    // Obtener fechas - manejar casos donde no hay fecha
                    const dateElementA = a.querySelector('.project-card-date span:first-child');
                    const dateElementB = b.querySelector('.project-card-date span:first-child');

                    const dateA = dateElementA && dateElementA.textContent !== 'Sin fecha' ?
                        new Date(dateElementA.textContent.split('/').reverse().join('-')) :
                        new Date(0);

                    const dateB = dateElementB && dateElementB.textContent !== 'Sin fecha' ?
                        new Date(dateElementB.textContent.split('/').reverse().join('-')) :
                        new Date(0);

                    // Obtener estados
                    const statusA = a.getAttribute('data-status');
                    const statusB = b.getAttribute('data-status');

                    switch(sortValue) {
                        case 'name-asc':
                            return titleA.localeCompare(titleB);
                        case 'name-desc':
                            return titleB.localeCompare(titleA);
                        case 'newest':
                            return dateB - dateA;
                        case 'oldest':
                            return dateA - dateB;
                        case 'status':
                            return statusA.localeCompare(statusB);
                        default:
                            return 0;
                    }
                });

                // Reinsertar proyectos ordenados
                projects.forEach(project => {
                    container.appendChild(project);
                });
            });

            // Botón para mostrar/ocultar calendario
            const toggleCalendarBtn = document.getElementById('toggleCalendarBtn');
            toggleCalendarBtn.addEventListener('click', function() {
                calendarVisible = !calendarVisible;
                const calendarSection = document.getElementById('calendarSection');

                if (calendarVisible) {
                    calendarSection.classList.add('visible');
                    toggleCalendarBtn.innerHTML = '<i class="fas fa-calendar-times"></i> Hide Calendar';
                    calendar.refetchEvents();
                } else {
                    calendarSection.classList.remove('visible');
                    toggleCalendarBtn.innerHTML = '<i class="fas fa-calendar"></i> Show Calendar';
                }
            });

            // Alternar visibilidad de proyectos completados
            document.getElementById('toggleCompletedProjects').addEventListener('click', function() {
                const completedContainer = document.getElementById('completedProjects');
                const toggleBtn = document.getElementById('toggleCompletedProjects');

                if (completedContainer.style.display === 'none') {
                    completedContainer.style.display = 'block';
                    toggleBtn.innerHTML = '<i class="fas fa-chevron-up"></i> Ocultar';
                } else {
                    completedContainer.style.display = 'none';
                    toggleBtn.innerHTML = '<i class="fas fa-chevron-down"></i> Mostrar';
                }
            });

            // Botón para mostrar proyectos completados
            document.getElementById('showCompletedBtn').addEventListener('click', function() {
                const completedContainer = document.getElementById('completedProjects');
                const toggleBtn = document.getElementById('toggleCompletedProjects');

                completedContainer.style.display = 'block';
                toggleBtn.innerHTML = '<i class="fas fa-chevron-up"></i> Ocultar';
                document.querySelector('.completed-projects-section').scrollIntoView({ behavior: 'smooth' });
            });
        } else {
            console.error("Bootstrap no está cargado correctamente");
            alert("Error: Bootstrap no se cargó correctamente");
        }
    });


    // Función para cambiar estado desde el modal de detalles
    function changeStatusFromModal(newStatus) {
        const projectCard = document.querySelector(`.project-card[data-id="${currentAlbumId}"]`);
        if (projectCard) {
            // Crear un evento artificial para pasar a changeAlbumStatus
            const event = { stopPropagation: () => {}, preventDefault: () => {} };
            changeAlbumStatus(event, projectCard, newStatus);
        }
        albumDetailsModal.hide();
    }


    // Inicializar el calendario
    function initCalendar() {
        const calendarEl = document.getElementById('calendar');

        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            // FullCalendar automatically handles locale based on the `locale` property.
            // We'll get this from a Thymeleaf variable.
            locale: translations.currentLocale, // This will be 'en', 'es', etc.
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,weekTable,timeGridDay'
            },
            customButtons: {
                weekTable: {
                    // Use translation for custom button text
                    text: translations.weekTableButton,
                    click: function() {
                        calendar.changeView('weekTable');
                    }
                }
            },
            buttonText: {
                // Use translations for FullCalendar's built-in button texts
                today: translations.todayButton,
                month: translations.monthButton,
                day: translations.dayButton,
                weekTable: translations.weekTableButton // Re-use for the button text within buttonText config
            },
            events: function(fetchInfo, successCallback, failureCallback) {
                fetch('/albumes/calendar-events')
                    .then(response => response.json())
                    .then(data => {
                        const events = data.map(album => {
                            let eventColor;
                            let className = '';

                            switch(album.estado) {
                                case 'completado':
                                    eventColor = '#6c757d';
                                    className = 'completed-event';
                                    break;
                                case 'anulado':
                                    eventColor = '#f94144';
                                    className = 'cancelled-event';
                                    break;
                                default:
                                    eventColor = '#006fa6';
                                    className = 'in-progress-event';
                            }

                            const event = {
                                id: album.id,
                                title: album.nombre, // Solo el nombre del proyecto
                                start: album.fechaInicio,
                                backgroundColor: eventColor,
                                borderColor: eventColor,
                                className: className,
                                extendedProps: {
                                    status: album.estado
                                }
                            };

                            if (album.horaInicio) {
                                const startDateTime = `${album.fechaInicio}T${album.horaInicio}`;
                                event.start = startDateTime;

                                if (album.horaFin) {
                                    const endDate = album.fechaFin ? album.fechaFin : album.fechaInicio;
                                    event.end = `${endDate}T${album.horaFin}`;
                                    event.allDay = false;
                                } else {
                                    event.allDay = true;
                                    if (album.fechaFin) {
                                        const endDate = new Date(album.fechaFin);
                                        endDate.setDate(endDate.getDate() + 1);
                                        event.end = endDate.toISOString().split('T')[0];
                                    }
                                }
                            } else {
                                event.allDay = true;
                                if (album.fechaFin) {
                                    const endDate = new Date(album.fechaFin);
                                    endDate.setDate(endDate.getDate() + 1);
                                    event.end = endDate.toISOString().split('T')[0];
                                }
                            }

                            return event;
                        });

                        successCallback(events);
                    })
                    .catch(error => {
                        console.error(translations.errorLoadingEvents, error); // Translated error message
                        failureCallback(error);
                    });
            },
            eventClick: function(info) {
                showContextMenu(info.jsEvent, info.event);
                info.jsEvent.preventDefault();
            },
            dateClick: function(info) {
                // Check for Thymeleaf variable directly as it's a server-side permission check
                if (/*[[${AGENDA_CREATE}]]*/ true) { // Make sure this Thymeleaf expression is actually defined
                    const fechaInicioInput = document.getElementById('fechaInicio');
                    const horaInicioInput = document.getElementById('horaInicio');
                    const horaFinInput = document.getElementById('horaFin');
                    const fechaSeleccionada = info.dateStr;

                    fechaInicioInput.value = fechaSeleccionada;

                    if (info.view.type === 'timeGridDay' || info.view.type === 'timeGridWeek') {
                        const now = new Date();
                        const hours = now.getHours().toString().padStart(2, '0');
                        const minutes = now.getMinutes().toString().padStart(2, '0');
                        horaInicioInput.value = `${hours}:${minutes}`;

                        const endTime = new Date(now.getTime() + 60 * 60 * 1000);
                        const endHours = endTime.getHours().toString().padStart(2, '0');
                        const endMinutes = endTime.getMinutes().toString().padStart(2, '0');
                        horaFinInput.value = `${endHours}:${endMinutes}`;
                    } else {
                        horaInicioInput.value = '';
                        horaFinInput.value = '';
                    }

                    document.getElementById('fechaFin').value = '';
                    // Assuming projectModal is a Bootstrap Modal instance
                    if (typeof projectModal !== 'undefined' && projectModal) {
                        projectModal.show();
                    } else {
                        console.warn("projectModal not found. Ensure it's initialized before initCalendar.");
                    }


                    // Dynamically build the modal title using translations and locale-aware date formatting
                    const newProjectTitle = translations.newProjectFor + ' ' +
                        info.date.toLocaleDateString(translations.currentLocale, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    document.getElementById('projectModalLabel').innerHTML =
                        '<i class="fas fa-plus-circle"></i> ' + newProjectTitle;
                }
            },
            views: {
                dayGridMonth: {},
                timeGridDay: {
                    dayHeaderFormat: { weekday: 'long', day: 'numeric', month: 'short' },
                    slotLabelFormat: {
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false
                    },
                    allDaySlot: false,
                    expandRows: true,
                    nowIndicator: true,
                    slotMinTime: '00:00:00',
                    slotMaxTime: '24:00:00',
                    slotDuration: '00:30:00',
                    eventTimeFormat: {
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false
                    }
                },
                weekTable: {
                    type: 'basicWeek',
                    duration: { weeks: 1 },
                    content: function() {
                        const container = document.createElement('div');
                        container.className = 'fc-week-table-view';

                        const events = calendar.getEvents();
                        const start = calendar.view.activeStart;
                        const daysOfWeek = [];

                        // Obtener los 7 días de la semana visible
                        for (let i = 0; i < 7; i++) {
                            const date = new Date(start);
                            date.setDate(start.getDate() + i);
                            daysOfWeek.push({
                                label: date.toLocaleDateString(translations.currentLocale, { weekday: 'short' }),

                                dateStr: date.toISOString().split('T')[0],
                                dateObj: new Date(date)
                            });
                        }

                        // Filtrar eventos para la semana visible
                        const viewStart = new Date(calendar.view.activeStart);
                        viewStart.setHours(0, 0, 0, 0);

                        const viewEnd = new Date(calendar.view.activeEnd);
                        viewEnd.setHours(0, 0, 0, 0);
                        viewEnd.setDate(viewEnd.getDate() - 1);

                        const proyectosSemana = events.filter(event => {
                            const eventStart = event.start ? new Date(event.start) : null;
                            let eventEnd = event.end ? new Date(event.end) : eventStart;

                            if (!eventStart) return false;

                            const startDate = new Date(eventStart);
                            startDate.setHours(0, 0, 0, 0);

                            const endDate = eventEnd ? new Date(eventEnd) : startDate;
                            endDate.setHours(23, 59, 59, 999);

                            return (startDate <= viewEnd && endDate >= viewStart);
                        });

                        // Crear la tabla
                        const table = document.createElement('table');
                        table.className = 'fc-week-table';

                        // Encabezado de la tabla
                        const thead = document.createElement('thead');
                        const headerRow = document.createElement('tr');

                        // Columna de nombre de proyecto
                        const projectHeader = document.createElement('th');
                        projectHeader.className = 'project-name-header';
                        projectHeader.textContent = translations.projectsHeader;
                        headerRow.appendChild(projectHeader);

                        // Encabezados de días
                        daysOfWeek.forEach(dia => {
                            const th = document.createElement('th');
                            th.textContent = dia.label;
                            headerRow.appendChild(th);
                        });

                        thead.appendChild(headerRow);
                        table.appendChild(thead);

                        // Cuerpo de la tabla
                        const tbody = document.createElement('tbody');

                        // Mostrar al menos 5 filas vacías o tantas como proyectos haya
                        const emptyRowsToShow = 5;
                        const rowsToCreate = Math.max(emptyRowsToShow, proyectosSemana.length);

                        for (let i = 0; i < rowsToCreate; i++) {
                            const tr = document.createElement('tr');
                            const proyecto = proyectosSemana[i];

                            // Configurar evento de clic si hay proyecto
                            if (proyecto) {
                                tr.addEventListener('click', function(e) {
                                    if (e.target.tagName !== 'TD' && e.target.tagName !== 'DIV' && e.target.tagName !== 'SPAN') {
                                        return;
                                    }
                                    showContextMenu(e, proyecto);
                                    e.preventDefault();
                                });
                            }

                            // Celda del nombre del proyecto
                            const tdProject = document.createElement('td');
                            tdProject.className = 'project-name-cell';

                            if (proyecto) {
                                // Establecer clase según estado
                                let statusClass = '';
                                switch(proyecto.extendedProps.status) {
                                    case 'completado':
                                        statusClass = 'completed';
                                        break;
                                    case 'anulado':
                                        statusClass = 'cancelled';
                                        break;
                                    default:
                                        statusClass = 'in-progress';
                                }
                                tdProject.classList.add(statusClass);
                                tdProject.textContent = proyecto.title;
                            }

                            tr.appendChild(tdProject);

                            // Celdas de días
                            daysOfWeek.forEach(dia => {
                                const td = document.createElement('td');
                                td.className = 'project-day-cell';

                                if (proyecto) {
                                    const eventStart = new Date(proyecto.start);
                                    eventStart.setHours(0, 0, 0, 0);

                                    let eventEnd = proyecto.end ? new Date(proyecto.end) : new Date(proyecto.start);
                                    if (proyecto.allDay && proyecto.end) {
                                        eventEnd = new Date(eventEnd);
                                        eventEnd.setDate(eventEnd.getDate() - 1);
                                    }
                                    eventEnd.setHours(23, 59, 59, 999);

                                    const currentDay = new Date(dia.dateObj);
                                    currentDay.setHours(0, 0, 0, 0);

                                    // Verificar si el evento ocurre en este día
                                    if (currentDay >= eventStart && currentDay <= eventEnd) {
                                        let statusClass = '';
                                        switch(proyecto.extendedProps.status) {
                                            case 'completado':
                                                statusClass = 'completed';
                                                break;
                                            case 'anulado':
                                                statusClass = 'cancelled';
                                                break;
                                            default:
                                                statusClass = 'in-progress';
                                        }
                                        td.classList.add(statusClass);

                                        // Crear indicador visual
                                        const indicator = document.createElement('div');
                                        indicator.className = `day-indicator ${statusClass}`;

                                        if (proyecto.extendedProps.status === 'completado') {
                                            const icon = document.createElement('i');
                                            icon.className = 'fas fa-check';
                                            indicator.appendChild(icon);
                                        } else if (proyecto.extendedProps.status === 'anulado') {
                                            const icon = document.createElement('i');
                                            icon.className = 'fas fa-times';
                                            indicator.appendChild(icon);
                                        } else {
                                            indicator.textContent = currentDay.getDate();
                                        }

                                        td.appendChild(indicator);
                                    }
                                }

                                tr.appendChild(td);
                            });

                            tbody.appendChild(tr);
                        }

                        table.appendChild(tbody);
                        container.appendChild(table);

                        return { domNodes: [container] };
                    }
                }
            },
            nowIndicator: true,
            eventContent: function(arg) {
                const eventEl = document.createElement('div');
                eventEl.className = 'fc-event-content';
                eventEl.style.whiteSpace = 'nowrap';
                eventEl.style.overflow = 'hidden';
                eventEl.style.textOverflow = 'ellipsis';

                // Solo mostrar el título del proyecto
                eventEl.textContent = arg.event.title;

                return { domNodes: [eventEl] };
            },
            height: 'auto'
        });

        calendar.render();
        calendarVisible = true;
        document.getElementById('calendarSection').classList.add('visible');
        // Using translation for the button text
        document.getElementById('toggleCalendarBtn').innerHTML = `<i class="fas fa-calendar-times"></i> ${translations.hideCalendarButton}`;
    }
    // Mostrar detalles del álbum por ID
    function showAlbumDetailsById(albumId) {
        currentAlbumId = albumId;

        fetch(`/albumes/${albumId}/details`)
            .then(response => {
                if (!response.ok) {
                    // Use a translated error message
                    throw new Error(translations.errorFetchingDetails);
                }
                return response.json();
            })
            .then(album => {
                const formatDate = (dateString) => {
                    if (!dateString) return '-';
                    const date = new Date(dateString);
                    // Adjust for timezone offset if dates are coming without timezone info
                    date.setMinutes(date.getMinutes() + date.getTimezoneOffset());
                    // Use the global locale for date formatting
                    return date.toLocaleDateString(translations.currentLocale);
                };

                const estadoElement = document.getElementById('detail-estado');
                // Use translated status names
                estadoElement.textContent = album.estado === 'completado' ? translations.statusCompleted :
                    album.estado === 'anulado' ? translations.statusCancelled :
                        translations.statusPending;

                // Aplicar clase según estado (classes remain programmatic, not translated)
                estadoElement.className = 'detail-value'; // Reset classes
                if (album.estado === 'completado') {
                    estadoElement.classList.add('status-completed');
                } else if (album.estado === 'anulado') {
                    estadoElement.classList.add('status-cancelled');
                } else {
                    estadoElement.classList.add('status-pending');
                }

                const formatTime = (timeString) => {
                    if (!timeString) return '-';
                    // Asumiendo que timeString viene en formato "HH:mm:ss" o similar
                    return timeString.substring(0, 5); // Tomamos solo HH:mm
                };

                document.getElementById('albumDetailsModalLabel').textContent = album.nombre;
                document.getElementById('detail-nombre').textContent = album.nombre || '-';
                document.getElementById('detail-descripcion').textContent = album.descripcion || '-';
                document.getElementById('detail-fechaInicio').textContent = formatDate(album.fechaInicio);
                document.getElementById('detail-horaInicio').textContent = formatTime(album.horaInicio);
                document.getElementById('detail-horaFin').textContent = formatTime(album.horaFin);
                document.getElementById('detail-fechaFin').textContent = formatDate(album.fechaFin);
                document.getElementById('detail-ubicacion').textContent = album.ubicacion || '-';
                document.getElementById('detail-contacto').textContent = album.contacto || '-';
                document.getElementById('detail-claveAlarma').textContent = album.claveAlarma || '-';
                document.getElementById('detail-notas').textContent = album.notas || '-';
                document.getElementById('detail-datosAdicionales').textContent = album.datosAdicionales || '-';
                // Concatenate translated 'hours' suffix
                document.getElementById('detail-horasPorProyecto').textContent = album.horasPorProyecto ? `${album.horasPorProyecto} ${translations.hoursSuffix}` : '-';
                document.getElementById('detail-precioHora').textContent = album.precioHora ? `$${album.precioHora.toFixed(2)}` : '-';

                // Agregar botones para cambiar estado en el modal de detalles
                const modalFooter = document.querySelector('#albumDetailsModal .modal-footer');

                // Limpiar botones existentes
                const existingStatusButtons = document.querySelectorAll('.status-change-btn');
                existingStatusButtons.forEach(btn => btn.remove());

                // Agregar botones solo si el usuario tiene permiso (Thymeleaf variable for JS)
                if (typeof hasStatusPermission !== 'undefined' && hasStatusPermission) {

                    if (album.estado !== 'pendiente') {
                        const pendingBtn = document.createElement('button');
                        pendingBtn.className = 'btn status-change-btn me-2';
                        pendingBtn.style.backgroundColor = '#66ccff'; // Consider making this a CSS class or variable
                        // Use translated button text
                        pendingBtn.innerHTML = `<i class="fas fa-clock"></i> ${translations.markInProgress}`;
                        pendingBtn.onclick = () => changeStatusFromModal('pendiente');
                        modalFooter.prepend(pendingBtn);
                    }

                    if (album.estado !== 'completado') {
                        const completeBtn = document.createElement('button');
                        completeBtn.className = 'btn btn-secondary status-change-btn me-2';
                        // Use translated button text
                        completeBtn.innerHTML = `<i class="fas fa-check"></i> ${translations.markCompleted}`;
                        completeBtn.onclick = () => changeStatusFromModal('completado');
                        modalFooter.prepend(completeBtn);
                    }

                    if (album.estado !== 'anulado') {
                        const cancelBtn = document.createElement('button');
                        cancelBtn.className = 'btn btn-danger status-change-btn me-2';
                        // Use translated button text
                        cancelBtn.innerHTML = `<i class="fas fa-times"></i> ${translations.markCancelled}`;
                        cancelBtn.onclick = () => changeStatusFromModal('anulado');
                        modalFooter.prepend(cancelBtn);
                    }
                }

                // Assuming albumDetailsModal is a Bootstrap Modal instance
                if (typeof albumDetailsModal !== 'undefined' && albumDetailsModal) {
                    albumDetailsModal.show();
                } else {
                    console.warn("albumDetailsModal not found. Ensure it's initialized.");
                }
            })
            .catch(error => {
                console.error(translations.errorGeneric, error); // Use translated generic error
                alert(translations.errorLoadingProjectDetails); // Use translated alert message
            });
    }


    // Función para editar el álbum
    function editAlbum(event, albumId) {
        event.stopPropagation();
        event.preventDefault();

        const idToEdit = albumId || currentAlbumId;
        if (idToEdit) {
            window.location.href = `/albumes/edit/${idToEdit}`;
        }
    }

    // Función para cambiar el estado del proyecto y moverlo entre secciones
    function changeAlbumStatus(event, projectCard, newStatus) {
        event.stopPropagation();
        event.preventDefault();

        const albumId = projectCard.getAttribute('data-id');
        if (!albumId) return;

        fetch(`/albumes/change-status/${albumId}?nuevoEstado=${newStatus}&actualizarFechaFin=false`, {
            method: 'POST'
        })
            .then(response => {
                if (response.ok) {
                    // 1. Actualizar atributos y estilos de la tarjeta
                    projectCard.setAttribute('data-status', newStatus);
                    projectCard.className = 'project-card'; // Reset classes
                    projectCard.classList.add(newStatus);

                    // Actualizar el badge de estado
                    const statusBadge = projectCard.querySelector('.status-badge');
                    if (statusBadge) {
                        statusBadge.className = 'status-badge';
                        statusBadge.classList.add(newStatus === 'completado' ? 'status-completed' :
                            newStatus === 'anulado' ? 'status-cancelled' : 'status-pending');
                        statusBadge.textContent = newStatus === 'completado' ? 'Completed' :
                            newStatus === 'anulado' ? 'Cancelled' : 'Pending';
                    }

                    // 2. Determinar contenedores de origen y destino
                    const activeContainer = document.querySelector('#activeProjects .projects-grid');
                    const archivedContainer = document.querySelector('#archivedProjects .projects-grid');

                    // 3. Mover la tarjeta al contenedor correspondiente
                    if (newStatus === 'pendiente') {
                        activeContainer.appendChild(projectCard);
                    } else {
                        archivedContainer.appendChild(projectCard);
                        // Mostrar sección archivada si estaba oculta
                        document.getElementById('archivedProjects').style.display = 'block';
                    }

                    // 4. Refrescar calendario si está visible
                    if (calendarVisible) {
                        calendar.refetchEvents();
                    }

                    showToast(`Project status changed to ${newStatus}`);
                } else {
                    throw new Error('Error changing status');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Error changing project status');
            });
    }

    // Función para mostrar/ocultar proyectos archivados
    function toggleArchivedProjects() {
        const archivedSection = document.getElementById('archivedProjects');
        if (archivedSection.style.display === 'none') {
            archivedSection.style.display = 'block';
        } else {
            archivedSection.style.display = 'none';
        }
    }

    // Modificación del DOMContentLoaded para clasificar proyectos al cargar
    document.addEventListener('DOMContentLoaded', function() {

        // Clasificar proyectos al cargar la página
        const projects = document.querySelectorAll('.project-card');
        const activeContainer = document.querySelector('#activeProjects .projects-grid');
        const archivedContainer = document.querySelector('#archivedProjects .projects-grid');

        projects.forEach(project => {
            const status = project.getAttribute('data-status');
            if (status === 'pendiente') {
                activeContainer.appendChild(project);
            } else {
                archivedContainer.appendChild(project);
            }
        });

        // Mostrar sección archivada si hay proyectos archivados
        if (archivedContainer.children.length > 0) {
            document.getElementById('archivedProjects').style.display = 'block';
        }

        // Modificar el botón "View Completed"
        document.getElementById('showCompletedBtn').addEventListener('click', function() {
            document.getElementById('archivedProjects').style.display = 'block';
            document.getElementById('archivedProjects').scrollIntoView({ behavior: 'smooth' });
        });
    });

    // Función para mostrar notificación
    function showNotification() {
        const notification = document.getElementById('successNotification');
        notification.style.display = 'block';
        setTimeout(hideNotification, 5000);
    }

    // Función para ocultar notificación
    function hideNotification() {
        document.getElementById('successNotification').style.display = 'none';
    }

    // Función para mostrar toast
    function showToast(message) {
        document.getElementById('toastMessage').textContent = message;
        var toastEl = document.getElementById('successToast');
        var toast = new bootstrap.Toast(toastEl);
        toast.show();
    }

    // Función para confirmar eliminación desde el modal de detalles
    function confirmDeleteAlbum() {
        if (!currentAlbumId) return;

        const confirmModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
        const confirmBtn = document.getElementById('confirmDeleteBtn');

        confirmBtn.replaceWith(confirmBtn.cloneNode(true));

        document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
            deleteAlbum(null, currentAlbumId);
            confirmModal.hide();
            albumDetailsModal.hide();
        });

        confirmModal.show();
    }

    // Función para eliminar un álbum
    function deleteAlbum(event, albumId) {
        if (event) {
            event.stopPropagation();
        }

        currentAlbumId = albumId;

        const confirmModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
        const confirmBtn = document.getElementById('confirmDeleteBtn');

        confirmBtn.replaceWith(confirmBtn.cloneNode(true));

        document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
            fetch(`/albumes/delete/${currentAlbumId}`, {
                method: 'GET'
            })
                .then(response => {
                    if (response.redirected) {
                        showToast('Proyecto eliminado correctamente');
                        setTimeout(() => {
                            window.location.href = response.url;
                        }, 1000);
                    } else {
                        throw new Error('Error al eliminar el proyecto');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast('Error al eliminar el proyecto');
                });

            confirmModal.hide();
        });

        confirmModal.show();
    }

    // Función para generar y descargar PDF
    function generatePdf() {
        if (!currentAlbumId) return;

        showToast('Generando PDF...');

        fetch(`/albumes/${currentAlbumId}/pdf`)
            .then(response => {
                if (!response.ok) throw new Error('Error al generar el PDF');
                return response.blob();
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `detalle_proyecto_${currentAlbumId}.pdf`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                a.remove();

                showToast('PDF generado con éxito');
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Error al generar el PDF');
            });
    }


    // Variables globales para el menú de contexto
    let contextMenuEventId = null;
    const contextMenu = document.getElementById('contextMenu');
    const notesModal = new bootstrap.Modal(document.getElementById('notesModal'));

    // Función para cerrar el menú de contexto
    function closeContextMenu() {
        contextMenu.style.display = 'none';
        document.removeEventListener('click', closeHandler);
    }

    // Función para abrir detalles desde el menú de contexto
    function openDetailsFromContextMenu() {
        if (contextMenuEventId) {
            showAlbumDetailsById(contextMenuEventId);
        }
        closeContextMenu();
    }

    // Handler para cerrar el menú si se hace clic fuera
    const closeHandler = (e) => {
        if (!contextMenu.contains(e.target)) {
            closeContextMenu();
        }
    };

    // Función para mostrar el menú de contexto
    function showContextMenu(jsEvent, calendarEvent) {
        jsEvent.stopPropagation(); // Evita que el clic que abre el menú también lo cierre

        // Ocultar cualquier menú previo
        contextMenu.style.display = 'none';

        // Guardar el ID del evento seleccionado
        contextMenuEventId = calendarEvent.id;

        // Obtener posición del cursor considerando el scroll
        const viewportX = jsEvent.clientX;
        const viewportY = jsEvent.clientY;

        // Calcular posición absoluta considerando el scroll
        const scrollX = window.pageXOffset || document.documentElement.scrollLeft;
        const scrollY = window.pageYOffset || document.documentElement.scrollTop;
        const absoluteX = viewportX + scrollX;
        const absoluteY = viewportY + scrollY;

        // Obtener dimensiones del menú
        const menuWidth = contextMenu.offsetWidth;
        const menuHeight = contextMenu.offsetHeight;

        // Obtener dimensiones de la ventana
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;

        // Ajustar posición si el menú se sale de la pantalla
        const adjustedX = (viewportX + menuWidth > windowWidth) ?
            absoluteX - menuWidth : absoluteX;
        const adjustedY = (viewportY + menuHeight > windowHeight) ?
            absoluteY - menuHeight : absoluteY;

        // Posicionar el menú
        contextMenu.style.position = 'absolute';
        contextMenu.style.left = `${adjustedX}px`;
        contextMenu.style.top = `${adjustedY}px`;
        contextMenu.style.display = 'block';
        contextMenu.style.zIndex = '10000';

        // Agregar listener para cerrar el menú si se hace clic fuera
        document.addEventListener('click', closeHandler);
    }

    // Función para abrir editor de notas desde el menú de contexto
    function openNotesFromContextMenu() {
        if (contextMenuEventId) {
            fetch(`/albumes/${contextMenuEventId}/notes`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('notesEditor').value = data.notes || '';
                    document.getElementById('notesModalLabel').textContent = `Notes: ${data.projectName}`;
                    notesModal.show();
                })
                .catch(error => {
                    console.error('Error loading notes:', error);
                    showToast('Error loading project notes');
                });
        }
        closeContextMenu();
    }

    // Función para guardar notas
    function saveNotes() {
        if (!contextMenuEventId) return;

        const notes = document.getElementById('notesEditor').value;

        fetch(`/albumes/${contextMenuEventId}/update-notes`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ notes: notes })
        })
            .then(response => {
                if (response.ok) {
                    showToast('Notes updated successfully');
                    notesModal.hide();

                    // Actualizar el evento en el calendario si está visible
                    if (calendarVisible) {
                        const event = calendar.getEventById(contextMenuEventId);
                        if (event) {
                            event.setExtendedProp('notes', notes);
                        }
                    }
                } else {
                    throw new Error('Error saving notes');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Error saving notes');
            });
    }

    // Variables globales para equipos
    let teamMembers = [];
    let selectedProject = null;
    let currentTeamId = null;
    const createTeamModal = new bootstrap.Modal(document.getElementById('createTeamModal'));
    const duplicateMemberModal = new bootstrap.Modal(document.getElementById('duplicateMemberModal'));
    let currentDuplicateEmployeeId = null;
    let projectTeams = [];
    let duplicateMembers = {};

    // Función para crear equipo desde el menú contextual
    function createTeamForProjectFromContextMenu() {
        if (!contextMenuEventId) return;

        // Obtener detalles del proyecto seleccionado
        const event = calendar.getEventById(contextMenuEventId);
        if (!event) return;

        // Configurar el proyecto seleccionado
        selectedProject = {
            id: contextMenuEventId,
            name: event.title
        };

        // Actualizar el nombre del proyecto en el modal
        document.getElementById('current-project-name').textContent = selectedProject.name;

        // Cargar empleados disponibles usando el nuevo endpoint
        fetch('/equipo/empleados/json')
            .then(response => {
                if (!response.ok) throw new Error('Error al obtener empleados');
                return response.json();
            })
            .then(empleados => {
                const employeesContainer = document.getElementById('available-employees');
                employeesContainer.innerHTML = '';

                empleados.forEach(empleado => {
                    const employeeItem = document.createElement('div');
                    employeeItem.className = 'selection-item';
                    employeeItem.dataset.employeeId = empleado.id;

                    employeeItem.innerHTML = `
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <div class="avatar me-3">
                                    <span>${empleado.nombre.charAt(0)}${empleado.email ? empleado.email.charAt(0) : ''}</span>
                                </div>
                                <div>
                                    <h6 class="mb-0">${empleado.nombre}</h6>
                                    <small class="text-muted">${empleado.tipo_usuario}</small>
                                </div>
                            </div>
                            <button class="btn btn-sm add-btn touch-feedback">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn btn-sm remove-btn touch-feedback">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    `;

                    employeesContainer.appendChild(employeeItem);

                    // Configurar eventos para este empleado
                    const addBtn = employeeItem.querySelector('.add-btn');
                    const removeBtn = employeeItem.querySelector('.remove-btn');

                    addBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        checkDuplicateMember(empleado.id, () => {
                            addTeamMember(empleado.id);
                        });
                    });

                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeTeamMember(empleado.id);
                    });

                    employeeItem.addEventListener('click', (e) => {
                        if (e.target === addBtn || e.target === removeBtn ||
                            e.target.closest('.add-btn') || e.target.closest('.remove-btn')) {
                            return;
                        }

                        if (employeeItem.classList.contains('selected')) {
                            removeTeamMember(empleado.id);
                        } else {
                            checkDuplicateMember(empleado.id, () => {
                                addTeamMember(empleado.id);
                            });
                        }
                    });
                });

                // Mostrar el modal
                createTeamModal.show();
                closeContextMenu();

                // Cargar equipos existentes para este proyecto
                loadProjectTeams(selectedProject.id);

                // Configurar el botón de guardar
                document.getElementById('save-team-btn').onclick = saveTeamForProject;

                // Event listener para cambios en el nombre del equipo
                document.getElementById('team-name').addEventListener('input', updateSaveButtonState);
                document.getElementById('team-description').addEventListener('input', updateSaveButtonState);
            })
            .catch(error => {
                console.error('Error loading employees:', error);
                showToast('Error loading employees list');
            });
    }

    // Función para verificar si un miembro ya está en otro equipo
    function checkDuplicateMember(employeeId, callback) {
        if (!selectedProject || !projectTeams || projectTeams.length === 0) {
            callback();
            return;
        }

        // Verificar si el empleado ya está en algún equipo del proyecto
        const isDuplicate = projectTeams.some(team =>
            team.miembros.some(member => member.id === employeeId)
        );

        if (isDuplicate) {
            // Obtener nombre del empleado
            const employeeName = document.querySelector(`.selection-item[data-employee-id="${employeeId}"] h6`).textContent;

            // Mostrar modal de confirmación
            document.getElementById('duplicate-member-message').textContent =
                `The member "${employeeName}" is already assigned to another team in this project.`;

            currentDuplicateEmployeeId = employeeId;

            // Configurar el botón de confirmación
            document.getElementById('confirm-duplicate-member').onclick = function() {
                duplicateMemberModal.hide();
                callback();
            };

            duplicateMemberModal.show();
        } else {
            callback();
        }
    }

    // Función para cargar los equipos del proyecto (actualizada)
    function loadProjectTeams(projectId) {
        const teamsListContainer = document.getElementById('project-teams-list');
        teamsListContainer.innerHTML = `
    <div class="text-center py-5 loading-teams">
        <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
        <p class="mt-3">${translations.loading_teams}</p>
    </div>`; // Using existing: "Loading teams..."

        fetch(`/equipo/por-proyecto/${projectId}`)
            .then(response => {
                if (!response.ok) {
                    // Using existing: "Error loading teams information"
                    throw new Error(translations.error_loading_teams);
                }
                return response.json();
            })
            .then(teams => {
                projectTeams = teams; // Guardar los equipos para verificación de duplicados
                const teamsListContainer = document.getElementById('project-teams-list');

                if (teams && teams.length > 0) {
                    let html = '';

                    // Actualizar contador de equipos
                    document.getElementById('teams-count').textContent = teams.length;

                    // Primero identificar miembros duplicados
                    duplicateMembers = {};
                    const memberCount = {};

                    teams.forEach(team => {
                        team.miembros.forEach(member => {
                            if (!memberCount[member.id]) {
                                memberCount[member.id] = 0;
                            }
                            memberCount[member.id]++;
                        });
                    });

                    // Marcar los miembros que aparecen más de una vez
                    for (const memberId in memberCount) {
                        if (memberCount[memberId] > 1) {
                            duplicateMembers[memberId] = true;
                        }
                    }

                    teams.forEach(team => {
                        html += `
                        <div class="team-card mb-3" data-team-id="${team.id}">
                            <div class="team-card-header">
                                <h5>${team.nombre}</h5>
                                <div class="team-actions">
                                    <button class="btn btn-sm btn-outline-primary edit-team-btn" data-team-id="${team.id}">
                                        <i class="fas fa-edit me-1"></i> ${translations.edit}
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger delete-team-btn" data-team-id="${team.id}">
                                        <i class="fas fa-trash-alt me-1"></i> ${translations.delete}
                                    </button>
                                </div>
                            </div>
                            <div class="team-card-body">
                                <p class="team-description">${team.descripcion || translations.no_description}</p>
                                <div class="team-members">
                                    <h6>${translations.team_members} (${team.miembros.length})</h6>
                                    
                                    <!-- Confirmed Members Section -->
                                    ${team.miembros.filter(m => m.estado === 'confirmado').length > 0 ? `
                                    <div class="members-section confirmed-members">
                                        <div class="members-section-label confirmed-label">
                                            <span>${translations.statusConfirmed || 'Confirmed'}</span>
                                        </div>
                                        <div class="members-list">
                                            ${team.miembros.filter(m => m.estado === 'confirmado').map(member => `
                                            <div class="member-item">
                                                <div class="member-avatar">
                                                    ${member.nombre.charAt(0)}${member.apellido ? member.apellido.charAt(0) : ''}
                                                </div>
                                                <div class="member-info">
                                                    <div class="member-name ${duplicateMembers[member.id] ? 'duplicate-member' : ''}">
                                                        ${member.nombre} ${member.apellido || ''}
                                                    </div>
                                                    <div class="member-role">${member.rol}</div>
                                                </div>
                                            </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                    
                                    <!-- Pending Members Section -->
                                    ${team.miembros.filter(m => m.estado === 'pendiente').length > 0 ? `
                                    <div class="members-section pending-members">
                                        <div class="members-section-label pending-label">
                                            <span>${translations.statusPending || 'Pending'}</span>
                                        </div>
                                        <div class="members-list">
                                            ${team.miembros.filter(m => m.estado === 'pendiente').map(member => `
                                            <div class="member-item">
                                                <div class="member-avatar">
                                                    ${member.nombre.charAt(0)}${member.apellido ? member.apellido.charAt(0) : ''}
                                                </div>
                                                <div class="member-info">
                                                    <div class="member-name ${duplicateMembers[member.id] ? 'duplicate-member' : ''}">
                                                        ${member.nombre} ${member.apellido || ''}
                                                    </div>
                                                    <div class="member-role">${member.rol}</div>
                                                </div>
                                            </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                    
                                    <!-- Rejected Members Section -->
                                    ${team.miembros.filter(m => m.estado === 'rechazado').length > 0 ? `
                                    <div class="members-section rejected-members">
                                        <div class="members-section-label rejected-label">
                                            <span>${translations.statusCancelled || 'Rejected'}</span>
                                        </div>
                                        <div class="members-list">
                                            ${team.miembros.filter(m => m.estado === 'rechazado').map(member => `
                                            <div class="member-item">
                                                <div class="member-avatar">
                                                    ${member.nombre.charAt(0)}${member.apellido ? member.apellido.charAt(0) : ''}
                                                </div>
                                                <div class="member-info">
                                                    <div class="member-name ${duplicateMembers[member.id] ? 'duplicate-member' : ''}">
                                                        ${member.nombre} ${member.apellido || ''}
                                                    </div>
                                                    <div class="member-role">${member.rol}</div>
                                                </div>
                                            </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>                `;
                    });

                    teamsListContainer.innerHTML = html;

                    // Agregar event listeners para los botones
                    document.querySelectorAll('.delete-team-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const teamId = this.getAttribute('data-team-id');
                            // Make sure deleteTeam function is defined and handles confirmation with translations
                            deleteTeam(teamId);
                        });
                    });

                    document.querySelectorAll('.edit-team-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const teamId = this.getAttribute('data-team-id');
                            // Make sure editTeam function is defined
                            editTeam(teamId);
                        });
                    });
                } else {
                    teamsListContainer.innerHTML = `
                <div class="text-center py-5 no-teams">
                    <i class="fas fa-users-slash fa-3x text-muted"></i>
                    <h5 class="mt-3">${translations.no_teams_found}</h5>
                    <p class="text-muted">${translations.no_teams_assigned}</p>
                </div>
            `;
                    document.getElementById('teams-count').textContent = '0';
                }
            })
            .catch(error => {
                console.error(translations.error_loading_teams, error); // Using existing
                teamsListContainer.innerHTML = `
            <div class="text-center py-5 error-loading">
                <i class="fas fa-exclamation-triangle fa-3x text-danger"></i>
                <h5 class="mt-3">${translations.error_loading_teams}</h5>
                <p class="text-muted">${error.message}</p>
            </div>
        `;
            });
    }

    // Función para editar un equipo
    function editTeam(teamId) {
        // Obtener detalles del equipo
        fetch(`/equipo/detalles/${teamId}`)
            .then(response => {
                if (!response.ok) throw new Error('Error al obtener detalles del equipo');
                return response.json();
            })
            .then(team => {
                // Configurar el modal para edición
                currentTeamId = teamId;
                document.getElementById('team-name').value = team.nombre;
                document.getElementById('team-description').value = team.descripcion || '';

                // Establecer los miembros actuales
                teamMembers = team.miembrosIds;

                // Marcar los miembros seleccionados
                document.querySelectorAll('#available-employees .selection-item').forEach(item => {
                    const employeeId = parseInt(item.dataset.employeeId);
                    if (teamMembers.includes(employeeId)) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                });

                // Actualizar el botón de guardar
                document.getElementById('save-team-btn').textContent = 'Update Team';
                document.getElementById('save-team-btn').onclick = updateTeam;

                // Mostrar el modal
                createTeamModal.show();

                // Cambiar a la pestaña de creación
                const createTeamTab = new bootstrap.Tab(document.getElementById('create-team-tab'));
                createTeamTab.show();
            })
            .catch(error => {
                console.error('Error loading team details:', error);
                showToast('Error loading team details');
            });
    }

    // Función para actualizar un equipo existente
    function updateTeam() {
        const teamName = document.getElementById('team-name').value.trim();
        const teamDescription = document.getElementById('team-description').value.trim();

        if (!teamName || teamMembers.length === 0 || !selectedProject) {
            return;
        }

        const saveBtn = document.getElementById('save-team-btn');
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Updating...';

        fetch('/equipo/editar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'equipoId': currentTeamId,
                'nombre': teamName,
                'descripcion': teamDescription,
                'proyectoId': selectedProject.id,
                'miembrosIds': teamMembers.join(',')
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error al actualizar el equipo');
                }
                return response.json();
            })
            .then(data => {
                showToast('Team updated successfully');
                resetTeamForm();

                if (selectedProject) {
                    loadProjectTeams(selectedProject.id);
                }

                // Cambiar a la pestaña de ver equipos
                const viewTeamsTab = new bootstrap.Tab(document.getElementById('view-teams-tab'));
                viewTeamsTab.show();
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Error updating team');
            })
            .finally(() => {
                saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Update Team';
                updateSaveButtonState();
            });
    }

    // Función para eliminar un equipo (actualizada con confirmación mejorada)
    function deleteTeam(teamId) {
        // Mostrar modal de confirmación personalizado
        const deleteModal = new bootstrap.Modal(document.getElementById('confirmDeleteModalteam'));
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

        // Configurar el evento una sola vez
        const deleteHandler = function() {
            confirmDeleteBtn.removeEventListener('click', deleteHandler);

            fetch(`/equipo/eliminar/${teamId}`, {
                method: 'POST'
            })
                .then(response => {
                    if (!response.ok) throw new Error('Error deleting team');
                    return response.json();
                })
                .then(data => {
                    showToast('Team deleted successfully');
                    deleteModal.hide();

                    // Recargar la lista de equipos
                    if (selectedProject) {
                        loadProjectTeams(selectedProject.id);
                    }
                })
                .catch(error => {
                    console.error('Error deleting team:', error);
                    showToast('Error deleting team');
                    deleteModal.hide();
                });
        };

        confirmDeleteBtn.addEventListener('click', deleteHandler);
        deleteModal.show();
    }

    // Función para añadir miembro al equipo
    function addTeamMember(employeeId) {
        if (!teamMembers.includes(employeeId)) {
            teamMembers.push(employeeId);
            const item = document.querySelector(`#available-employees .selection-item[data-employee-id="${employeeId}"]`);
            if (item) {
                item.classList.add('selected');
            }
            updateSaveButtonState();
        }
    }

    // Función para remover miembro del equipo
    function removeTeamMember(employeeId) {
        teamMembers = teamMembers.filter(id => id !== employeeId);
        const item = document.querySelector(`#available-employees .selection-item[data-employee-id="${employeeId}"]`);
        if (item) {
            item.classList.remove('selected');
        }
        updateSaveButtonState();
    }

    // Función para actualizar el estado del botón de guardar
    function updateSaveButtonState() {
        const teamNameValid = document.getElementById('team-name').value.trim().length > 0;
        const hasMembers = teamMembers.length > 0;
        const hasProject = selectedProject !== null;

        document.getElementById('save-team-btn').disabled = !(teamNameValid && hasMembers && hasProject);
    }

    // Función para guardar el equipo para el proyecto
    function saveTeamForProject() {
        const teamName = document.getElementById('team-name').value.trim();
        const teamDescription = document.getElementById('team-description').value.trim();

        if (!teamName || teamMembers.length === 0 || !selectedProject) {
            return;
        }

        // Deshabilitar botón durante la operación
        const saveBtn = document.getElementById('save-team-btn');
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';

        // Enviar datos al servidor
        fetch('/equipo/guardar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'nombre': teamName,
                'descripcion': teamDescription,
                'proyectoId': selectedProject.id,
                'miembrosIds': teamMembers.join(',')
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error al guardar el equipo');
                }
                return response.json();
            })
            .then(data => {
                showToast('Team created successfully');

                // Resetear el formulario
                resetTeamForm();

                // Recargar la lista de equipos
                if (selectedProject) {
                    loadProjectTeams(selectedProject.id);
                }

                // Cambiar a la pestaña de ver equipos
                const viewTeamsTab = new bootstrap.Tab(document.getElementById('view-teams-tab'));
                viewTeamsTab.show();
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Error saving team');
            })
            .finally(() => {
                saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Save Team';
                updateSaveButtonState();
            });
    }

    // Función para resetear el formulario de equipo (actualizada)
    function resetTeamForm() {
        document.getElementById('team-name').value = '';
        document.getElementById('team-description').value = '';
        teamMembers = [];
        currentTeamId = null;

        // Restaurar el botón de guardar a su estado original
        document.getElementById('save-team-btn').textContent = 'Save Team';
        document.getElementById('save-team-btn').onclick = saveTeamForProject;

        // Limpiar selecciones
        document.querySelectorAll('#available-employees .selected').forEach(item => {
            item.classList.remove('selected');
        });
    }

</script>

</body>
</html>